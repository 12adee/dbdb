function f(e,a,t){const c=new Set(a),o=Math.ceil(e.length/t),n=[];let s=0;function p(){const r=s*t,h=Math.min(r+t,e.length);e.slice(r,h).forEach(l=>{c.has(l)&&n.push(l)}),s++;const m=Math.round(s/o*100);self.postMessage({type:"compareProgress",progress:m,processed:s*t,total:e.length}),s<o?setTimeout(p,0):self.postMessage({type:"compared",common:n})}p()}self.onmessage=e=>{const{type:a,data:t,file1Records:c,file2Records:o}=e.data;switch(a){case"process":const n=t.split(`
`).map(s=>s.trim()).filter(Boolean);self.postMessage({type:"processed",records:n});break;case"compare":f(c,o,1e4);break}};
